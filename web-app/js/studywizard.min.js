var tableEditor=null;var warnOnRedirect=true;$(document).ready(function(){insertOnRedirectWarning();onStudyWizardPage()});function onStudyWizardPage(){attachHelpTooltips();attachDatePickers();attachDateTimePickers();disableKeys();disableDatePickerKeys();$(":checkbox[name^='public']").on('change',function(){var box=$(this);if(box.is(':checked')){$("#dialog-creative-commons").dialog({resizable:false,height:250,width:800,modal:true,buttons:{"Yes":function(){$(this).dialog("close")},"No":function(){$(this).dialog("close");box.attr('checked',false)}}})}});tableEditor=new TableEditor().init({tableIdentifier:'div.tableEditor',rowIdentifier:'div.row',columnIdentifier:'div.firstColumn, div.column',headerIdentifier:'div.header'});new OntologyChooser().init();new SelectAddMore().init({rel:'term',url:baseUrl+'/termEditor',vars:'ontologies',label:'add more...',style:'addMore',onClose:function(scope){refreshFlow()}});new SelectAddMore().init({rel:'template',url:baseUrl+'/templateEditor',vars:'entity,ontologies',label:'add / modify..',style:'modify',onClose:function(scope){refreshFlow()}});new SelectAddMore().init({rel:'person',url:baseUrl+'/person/list?dialog=true',vars:'person',label:'add / modify persons...',style:'modify',onClose:function(scope){refreshFlow()}});new SelectAddMore().init({rel:'role',url:baseUrl+'/personRole/list?dialog=true',vars:'role',label:'add / modify roles...',style:'modify',onClose:function(scope){refreshFlow()}});new FuzzyStringMatcher().init({});$("#accordion").accordion({autoHeight:false})}function disableDatePickerKeys(){$(".hasDatepicker").each(function(){$(this).bind('keydown',function(e){return false})})}function insertOnRedirectWarning(){$('a').each(function(){var element=$(this);var re=/^#/gi;if(!element.attr('href').match(/^#/gi)&&!element.attr('href').match(/\/([^\/]+)\/wizard\/pages/gi)&&element.attr('target')=="undefined"){element.bind('click',function(){if(warnOnRedirect){return onDirectWarning()}})}})}function onDirectWarning(){return confirm('Warning: navigating away from the wizard causes loss of work and unsaved data. Are you sure you want to continue?')}function attachDatePickers(){$("input[type=text][rel$='date']").each(function(){$(this).datepicker({changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:'dd/mm/yy',yearRange:'c-80:c+20',altField:'#'+$(this).attr('name')+'Example',altFormat:'DD, d MM, yy'})})}function attachDateTimePickers(){$("input[type=text][rel$='datetime']").each(function(){$(this).datepicker({changeMonth:true,changeYear:true,dateFormat:'dd/mm/yy',altField:'#'+$(this).attr('name')+'Example',altTimeField:'#'+$(this).attr('name')+'Example2',altFormat:'DD, d MM, yy',showTime:true,time24h:true})})}function handleWizardTable(){}function showExampleReltime(inputfield){var fieldName=inputfield.name;var successFunc=function(data,textStatus,request){var exampleField=document.getElementById(fieldName+"Example");if(request.status==200&&exampleField){document.getElementById(fieldName+"Example").value=data}};var errorFunc=function(request,textStatus,errorThrown){var exampleField=document.getElementById(fieldName+"Example");if(exampleField){document.getElementById(fieldName+"Example").value=""}};$.ajax({url:baseUrl+'/studyWizard/ajaxParseRelTime?reltime='+inputfield.value,success:successFunc,error:errorFunc})}function fileUploadField(field_id){new AjaxUpload('#upload_button_'+field_id,{action:baseUrl+'/file/upload',data:{},name:field_id,autoSubmit:true,onChange:function(file,ext){oldFile=$('#'+field_id).val();if(oldFile!=''&&oldFile!='existing*'&&oldFile!='*deleted*'){if(!confirm('The old file is deleted when uploading a new file. Do you want to continue?')){return false}}this.setData({'field':field_id,'oldFile':oldFile});$('#'+field_id+'Example').html('Uploading '+createFileHTML(file));$('#'+field_id+'Delete').hide()},onComplete:function(file,response){if(response==""){$('#'+field_id).val('');$('#'+field_id+'Example').html('<span class="error">Error uploading '+createFileHTML(file)+'</span>');$('#'+field_id+'Delete').hide()}else{response=response.replace(/<\/?[^>]+>/gi,'');$('#'+field_id).val(response);$('#'+field_id+'Example').html('Uploaded '+createFileHTML(file));$('#'+field_id+'Delete').show()}}})}function deleteFile(field_id){$('#'+field_id).val('*deleted*');$('#'+field_id+'Example').html('File deleted');$('#'+field_id+'Delete').hide()}function createFileHTML(filename){return'<a target="_blank" href="'+baseUrl+'/file/get/'+filename+'">'+filename+'</a>'}function addPublication(element_id){jQuery.ajax({type:"GET",url:baseUrl+"/publication/getID?"+$("#"+element_id+"_form").serialize(),success:function(data,textStatus){var id=parseInt(data);var ids=getPublicationIds(element_id);if($.inArray(id,ids)==-1){ids[ids.length]=id;$('#'+element_id+'_ids').val(ids.join(','));showPublication(element_id,id,$("#"+element_id+"_form").find('[name=publication-title]').val(),$("#"+element_id+"_form").find('[name=publication-authorsList]').val(),ids.length-1);$('#'+element_id+'_none').hide()}},error:function(XMLHttpRequest,textStatus,errorThrown){alert("Publication could not be added.")}});return false}function removePublication(element_id,id){var ids=getPublicationIds(element_id);if($.inArray(id,ids)!=-1){ids.splice($.inArray(id,ids),1);$('#'+element_id+'_ids').val(ids.join(','));var li=$("#"+element_id+'_item_'+id);if(li){li.remove()}if(ids.length==0){$('#'+element_id+'_none').show()}}}function getPublicationIds(element_id){var ids=$('#'+element_id+'_ids').val();if(ids==""){return new Array()}else{ids_array=ids.split(',');for(var i=0;i<ids_array.length;i++){ids_array[i]=parseInt(ids_array[i])}return ids_array}}function showPublication(element_id,id,title,authors,nr){var deletebutton=document.createElement('img');deletebutton.className='famfamfam delete_button';deletebutton.setAttribute('alt','remove this publication');deletebutton.setAttribute('src',baseUrl+'/plugins/famfamfam-1.0.1/images/icons/delete.png');deletebutton.onclick=function(){removePublication(element_id,id);return false};var titleDiv=document.createElement('div');titleDiv.className='title';titleDiv.appendChild(document.createTextNode(title));var authorsDiv=document.createElement('div');authorsDiv.className='authors';authorsDiv.appendChild(document.createTextNode(authors));var li=document.createElement('li');li.setAttribute('id',element_id+'_item_'+id);li.className=nr%2==0?'even':'odd';li.appendChild(deletebutton);li.appendChild(titleDiv);li.appendChild(authorsDiv);$('#'+element_id+'_list').append(li)}function createPublicationDialog(element_id){if($("."+element_id+"_publication_dialog").length==0){$("#"+element_id+"_dialog").dialog({title:"Add publication",autoOpen:false,width:800,height:400,modal:true,dialogClass:element_id+"_publication_dialog",position:"center",buttons:{Add:function(){addPublication(element_id);$(this).dialog("close")},Close:function(){$(this).dialog("close")}},close:function(){}}).width(790).height(400)}else{$("#"+element_id+"_dialog").remove()}}function openPublicationDialog(element_id){var field=$('#'+element_id);field.autocomplete('close');field.val('');$('#'+element_id+'_dialog').dialog('open');field.focus();enableButton('.'+element_id+'_publication_dialog','Add',false)}function getDialogButton(dialog_selector,button_name){var buttons=$(dialog_selector+' .ui-dialog-buttonpane button');for(var i=0;i<buttons.length;++i){var jButton=$(buttons[i]);if(jButton.text()==button_name){return jButton}}return null}function enableButton(dialog_selector,button_name,enable){var dlgButton=getDialogButton(dialog_selector,button_name);if(dlgButton){if(enable){dlgButton.removeAttr('disabled');dlgButton.removeClass('ui-state-disabled')}else{dlgButton.attr('disabled','disabled');dlgButton.addClass('ui-state-disabled')}}}function addContact(element_id){var person_id=$('#'+element_id+'_person').val();var role_id=$('#'+element_id+'_role').val();if(person_id==""||person_id==0||role_id==""||role_id==0){alert("Please select both a person and a role.");return false}var combination=person_id+'-'+role_id;var ids=getContactIds(element_id);if($.inArray(combination,ids)==-1){ids[ids.length]=combination;$('#'+element_id+'_ids').val(ids.join(','));showContact(element_id,combination,$("#"+element_id+"_person  :selected").text(),$("#"+element_id+"_role :selected").text(),ids.length-1);$('#'+element_id+'_none').hide()}return true}function removeContact(element_id,combination){var ids=getContactIds(element_id);if($.inArray(combination,ids)!=-1){ids.splice($.inArray(combination,ids),1);$('#'+element_id+'_ids').val(ids.join(','));var li=$("#"+element_id+'_item_'+combination);if(li){li.remove()}if(ids.length==0){$('#'+element_id+'_none').show()}}}function getContactIds(element_id){var ids=$('#'+element_id+'_ids').val();if(ids==""){return new Array()}else{ids_array=ids.split(',');return ids_array}}function showContact(element_id,id,fullName,role,nr){var deletebutton=document.createElement('img');deletebutton.className='famfamfam delete_button';deletebutton.setAttribute('alt','remove this person');deletebutton.setAttribute('src',baseUrl+'/plugins/famfamfam-1.0.1/images/icons/delete.png');deletebutton.onclick=function(){removeContact(element_id,id);return false};var titleDiv=document.createElement('div');titleDiv.className='person';titleDiv.appendChild(document.createTextNode(fullName));var authorsDiv=document.createElement('div');authorsDiv.className='role';authorsDiv.appendChild(document.createTextNode(role));var li=document.createElement('li');li.setAttribute('id',element_id+'_item_'+id);li.className=nr%2==0?'even':'odd';li.appendChild(deletebutton);li.appendChild(titleDiv);li.appendChild(authorsDiv);$('#'+element_id+'_list').append(li)}function addUser(element_id){id=parseInt($("#"+element_id+"_form select").val());var ids=getUserIds(element_id);if($.inArray(id,ids)==-1){ids[ids.length]=id;$('#'+element_id+'_ids').val(ids.join(','));showUser(element_id,id,$("#"+element_id+"_form select option:selected").text(),ids.length-1);$('#'+element_id+'_none').css('display','none')}return false}function removeUser(element_id,id){var ids=getUserIds(element_id);if($.inArray(id,ids)!=-1){ids.splice($.inArray(id,ids),1);$('#'+element_id+'_ids').val(ids.join(','));var li=$("#"+element_id+'_item_'+id);if(li){li.remove()}if(ids.length==0){$('#'+element_id+'_none').css('display','inline')}}}function getUserIds(element_id){var ids=$('#'+element_id+'_ids').val();if(ids==""){return new Array()}else{ids_array=ids.split(',');for(var i=0;i<ids_array.length;i++){ids_array[i]=parseInt(ids_array[i])}return ids_array}}function showUser(element_id,id,username,nr){var deletebutton=document.createElement('img');deletebutton.className='famfamfam delete_button';deletebutton.setAttribute('alt','remove this user');deletebutton.setAttribute('src',baseUrl+'/plugins/famfamfam-1.0.1/images/icons/delete.png');deletebutton.onclick=function(){removeUser(element_id,id);return false};var titleDiv=document.createElement('div');titleDiv.className='username';titleDiv.appendChild(document.createTextNode(username));var li=document.createElement('li');li.setAttribute('id',element_id+'_item_'+id);li.className=nr%2==0?'even':'odd';li.appendChild(deletebutton);li.appendChild(titleDiv);$('#'+element_id+'_list').append(li)}function createUserDialog(element_id){if($("."+element_id+"_user_dialog").length==0){$("#"+element_id+"_dialog").dialog({title:"Add user",autoOpen:false,width:800,height:400,modal:true,dialogClass:element_id+"_user_dialog",position:"center",buttons:{Add:function(){addUser(element_id);$(this).dialog("close")},Close:function(){$(this).dialog("close")}},close:function(){}}).width(790).height(400)}else{$("#"+element_id+"_dialog").remove()}}function openUserDialog(element_id){var field=$('#'+element_id);field.val('');$('#'+element_id+'_dialog').dialog('open');field.focus()}