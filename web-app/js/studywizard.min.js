function onStudyWizardPage(){attachHelpTooltips();attachDatePickers();attachDateTimePickers();disableKeys();disableDatePickerKeys();$(":checkbox[name^='public']").on("change",function(){var e=$(this);if(e.is(":checked")){$("#dialog-creative-commons").dialog({resizable:false,height:250,width:800,modal:true,buttons:{Yes:function(){$(this).dialog("close")},No:function(){$(this).dialog("close");e.attr("checked",false)}}})}});tableEditor=(new TableEditor).init({tableIdentifier:"div.tableEditor",rowIdentifier:"div.row",columnIdentifier:"div.firstColumn, div.column",headerIdentifier:"div.header"});(new OntologyChooser).init();(new SelectAddMore).init({rel:"term",url:baseUrl+"/termEditor",vars:"ontologies",label:"add more...",style:"addMore",onClose:function(e){refreshFlow()}});(new SelectAddMore).init({rel:"template",url:baseUrl+"/templateEditor",vars:"entity,ontologies",label:"add / modify..",style:"modify",onClose:function(e){refreshFlow()}});(new SelectAddMore).init({rel:"person",url:baseUrl+"/person/list?dialog=true",vars:"person",label:"add / modify persons...",style:"modify",onClose:function(e){refreshFlow()}});(new SelectAddMore).init({rel:"role",url:baseUrl+"/personRole/list?dialog=true",vars:"role",label:"add / modify roles...",style:"modify",onClose:function(e){refreshFlow()}});(new FuzzyStringMatcher).init({});$("#accordion").accordion({autoHeight:false})}function disableDatePickerKeys(){$(".hasDatepicker").each(function(){$(this).bind("keydown",function(e){return false})})}function insertOnRedirectWarning(){$("a").each(function(){var e=$(this);var t=/^#/gi;if(!e.attr("href").match(/^#/gi)&&!e.attr("href").match(/\/([^\/]+)\/wizard\/pages/gi)&&e.attr("target")=="undefined"){e.bind("click",function(){if(warnOnRedirect){return onDirectWarning()}})}})}function onDirectWarning(){return confirm("Warning: navigating away from the wizard causes loss of work and unsaved data. Are you sure you want to continue?")}function attachDatePickers(){$("input[type=text][rel$='date']").each(function(){$(this).datepicker({changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:"dd/mm/yy",yearRange:"c-80:c+20",altField:"#"+$(this).attr("name")+"Example",altFormat:"DD, d MM, yy"})})}function attachDateTimePickers(){$("input[type=text][rel$='datetime']").each(function(){$(this).datepicker({changeMonth:true,changeYear:true,dateFormat:"dd/mm/yy",altField:"#"+$(this).attr("name")+"Example",altTimeField:"#"+$(this).attr("name")+"Example2",altFormat:"DD, d MM, yy",showTime:true,time24h:true})})}function handleWizardTable(){}function showExampleReltime(e){var t=e.name;var n=function(e,n,r){var i=document.getElementById(t+"Example");if(r.status==200&&i){document.getElementById(t+"Example").value=e}};var r=function(e,n,r){var i=document.getElementById(t+"Example");if(i){document.getElementById(t+"Example").value=""}};$.ajax({url:baseUrl+"/studyWizard/ajaxParseRelTime?reltime="+e.value,success:n,error:r})}function fileUploadField(e){new AjaxUpload("#upload_button_"+e,{action:baseUrl+"/file/upload",data:{},name:e,autoSubmit:true,onChange:function(t,n){oldFile=$("#"+e).val();if(oldFile!=""&&oldFile!="existing*"&&oldFile!="*deleted*"){if(!confirm("The old file is deleted when uploading a new file. Do you want to continue?")){return false}}this.setData({field:e,oldFile:oldFile});$("#"+e+"Example").html("Uploading "+createFileHTML(t));$("#"+e+"Delete").hide()},onComplete:function(t,n){if(n==""){$("#"+e).val("");$("#"+e+"Example").html('<span class="error">Error uploading '+createFileHTML(t)+"</span>");$("#"+e+"Delete").hide()}else{n=n.replace(/<\/?[^>]+>/gi,"");$("#"+e).val(n);$("#"+e+"Example").html("Uploaded "+createFileHTML(t));$("#"+e+"Delete").show()}}})}function deleteFile(e){$("#"+e).val("*deleted*");$("#"+e+"Example").html("File deleted");$("#"+e+"Delete").hide()}function createFileHTML(e){return'<a target="_blank" href="'+baseUrl+"/file/get/"+e+'">'+e+"</a>"}function addPublication(e){jQuery.ajax({type:"GET",url:baseUrl+"/publication/getID?"+$("#"+e+"_form").serialize(),success:function(t,n){var r=parseInt(t);var i=getPublicationIds(e);if($.inArray(r,i)==-1){i[i.length]=r;$("#"+e+"_ids").val(i.join(","));showPublication(e,r,$("#"+e+"_form").find("[name=publication-title]").val(),$("#"+e+"_form").find("[name=publication-authorsList]").val(),i.length-1);$("#"+e+"_none").hide()}},error:function(e,t,n){alert("Publication could not be added.")}});return false}function removePublication(e,t){var n=getPublicationIds(e);if($.inArray(t,n)!=-1){n.splice($.inArray(t,n),1);$("#"+e+"_ids").val(n.join(","));var r=$("#"+e+"_item_"+t);if(r){r.remove()}if(n.length==0){$("#"+e+"_none").show()}}}function getPublicationIds(e){var t=$("#"+e+"_ids").val();if(t==""){return new Array}else{ids_array=t.split(",");for(var n=0;n<ids_array.length;n++){ids_array[n]=parseInt(ids_array[n])}return ids_array}}function showPublication(e,t,n,r,i){var s=document.createElement("img");s.className="famfamfam delete_button";s.setAttribute("alt","remove this publication");s.setAttribute("src",baseUrl+"/plugins/famfamfam-1.0.1/images/icons/delete.png");s.onclick=function(){removePublication(e,t);return false};var o=document.createElement("div");o.className="title";o.appendChild(document.createTextNode(n));var u=document.createElement("div");u.className="authors";u.appendChild(document.createTextNode(r));var a=document.createElement("li");a.setAttribute("id",e+"_item_"+t);a.className=i%2==0?"even":"odd";a.appendChild(s);a.appendChild(o);a.appendChild(u);$("#"+e+"_list").append(a)}function createPublicationDialog(e){if($("."+e+"_publication_dialog").length==0){$("#"+e+"_dialog").dialog({title:"Add publication",autoOpen:false,width:800,height:400,modal:true,dialogClass:e+"_publication_dialog",position:"center",buttons:{Add:function(){addPublication(e);$(this).dialog("close")},Close:function(){$(this).dialog("close")}},close:function(){}}).width(790).height(400)}else{$("#"+e+"_dialog").remove()}}function openPublicationDialog(e){var t=$("#"+e);t.autocomplete("close");t.val("");$("#"+e+"_dialog").dialog("open");t.focus();enableButton("."+e+"_publication_dialog","Add",false)}function getDialogButton(e,t){var n=$(e+" .ui-dialog-buttonpane button");for(var r=0;r<n.length;++r){var i=$(n[r]);if(i.text()==t){return i}}return null}function enableButton(e,t,n){var r=getDialogButton(e,t);if(r){if(n){r.removeAttr("disabled","");r.removeClass("ui-state-disabled")}else{r.attr("disabled","disabled");r.addClass("ui-state-disabled")}}}function addContact(e){var t=$("#"+e+"_person").val();var n=$("#"+e+"_role").val();if(t==""||t==0||n==""||n==0){alert("Please select both a person and a role.");return false}var r=t+"-"+n;var i=getContactIds(e);if($.inArray(r,i)==-1){i[i.length]=r;$("#"+e+"_ids").val(i.join(","));showContact(e,r,$("#"+e+"_person  :selected").text(),$("#"+e+"_role :selected").text(),i.length-1);$("#"+e+"_none").hide()}return true}function removeContact(e,t){var n=getContactIds(e);if($.inArray(t,n)!=-1){n.splice($.inArray(t,n),1);$("#"+e+"_ids").val(n.join(","));var r=$("#"+e+"_item_"+t);if(r){r.remove()}if(n.length==0){$("#"+e+"_none").show()}}}function getContactIds(e){var t=$("#"+e+"_ids").val();if(t==""){return new Array}else{ids_array=t.split(",");return ids_array}}function showContact(e,t,n,r,i){var s=document.createElement("img");s.className="famfamfam delete_button";s.setAttribute("alt","remove this person");s.setAttribute("src",baseUrl+"/plugins/famfamfam-1.0.1/images/icons/delete.png");s.onclick=function(){removeContact(e,t);return false};var o=document.createElement("div");o.className="person";o.appendChild(document.createTextNode(n));var u=document.createElement("div");u.className="role";u.appendChild(document.createTextNode(r));var a=document.createElement("li");a.setAttribute("id",e+"_item_"+t);a.className=i%2==0?"even":"odd";a.appendChild(s);a.appendChild(o);a.appendChild(u);$("#"+e+"_list").append(a)}function addUser(e){id=parseInt($("#"+e+"_form select").val());var t=getUserIds(e);if($.inArray(id,t)==-1){t[t.length]=id;$("#"+e+"_ids").val(t.join(","));showUser(e,id,$("#"+e+"_form select option:selected").text(),t.length-1);$("#"+e+"_none").css("display","none")}return false}function removeUser(e,t){var n=getUserIds(e);if($.inArray(t,n)!=-1){n.splice($.inArray(t,n),1);$("#"+e+"_ids").val(n.join(","));var r=$("#"+e+"_item_"+t);if(r){r.remove()}if(n.length==0){$("#"+e+"_none").css("display","inline")}}}function getUserIds(e){var t=$("#"+e+"_ids").val();if(t==""){return new Array}else{ids_array=t.split(",");for(var n=0;n<ids_array.length;n++){ids_array[n]=parseInt(ids_array[n])}return ids_array}}function showUser(e,t,n,r){var i=document.createElement("img");i.className="famfamfam delete_button";i.setAttribute("alt","remove this user");i.setAttribute("src",baseUrl+"/plugins/famfamfam-1.0.1/images/icons/delete.png");i.onclick=function(){removeUser(e,t);return false};var s=document.createElement("div");s.className="username";s.appendChild(document.createTextNode(n));var o=document.createElement("li");o.setAttribute("id",e+"_item_"+t);o.className=r%2==0?"even":"odd";o.appendChild(i);o.appendChild(s);$("#"+e+"_list").append(o)}function createUserDialog(e){if($("."+e+"_user_dialog").length==0){$("#"+e+"_dialog").dialog({title:"Add user",autoOpen:false,width:800,height:400,modal:true,dialogClass:e+"_user_dialog",position:"center",buttons:{Add:function(){addUser(e);$(this).dialog("close")},Close:function(){$(this).dialog("close")}},close:function(){}}).width(790).height(400)}else{$("#"+e+"_dialog").remove()}}function openUserDialog(e){var t=$("#"+e);t.val("");$("#"+e+"_dialog").dialog("open");t.focus()}var tableEditor=null;var warnOnRedirect=true;$(document).ready(function(){insertOnRedirectWarning();onStudyWizardPage()})