function selectQueryableFieldItem(e){var t="";var n="";if(e!=null){t=e.show;n=e.value;$("#queryFieldText").val(t)}$("#queryField").val(n);if(n==""){$("#queryFieldText").css("background-color","#FDD");$(".newCriterion .addButton a").addClass("disabled")}else{$("#queryFieldText").css("background-color","white");$(".newCriterion .addButton a").removeClass("disabled")}toggleSearchButton()}function toggleSearchButton(){if($("#criteria li:not(.newCriterion):not(.titlerow)").length==0&&$("#queryField").val()==""){$(".submitcriteria").attr("disabled",true)}else{$(".submitcriteria").removeAttr("disabled")}}function addCriterion(){var e=$("#searchForm #queryField").val();var t=$("#searchForm input#value").val();var n=$("#searchForm select#operator").val();if(e==""){alert("Please select a field to search in.");return}showCriterium(e,t,n);toggleSearchMode();$("#searchForm #queryFieldText").val("");$("#searchForm #queryField").val("");$("#searchForm select#operator").val("equals");$("#searchForm input#value").val("");$("#searchForm .newCriterion .addButton a").addClass("disabled");updateAutocomplete()}function removeCriterium(e){e.remove();toggleSearchMode();toggleSearchButton()}function toggleSearchMode(){if($("#criteria li:not(.newCriterion):not(.titlerow)").length==0){$("#searchMode").hide()}else{$("#searchMode").show()}}function showCriterium(e,t,n){var r=createCriteriumElement("entityfield",e);var i=createCriteriumElement("operator",n);var s;if(n=="in")s=createInSearchElement("value",t);else s=createCriteriumElement("value",t);var o=$('<a href="#" onClick="return false;"><img src="../plugins/famfamfam-1.0.1/images/icons/delete.png" border="0"></a>');o.bind("click",function(){if(confirm("Are you sure you want to remove this criterium?")){removeCriterium($(this).closest("li"));return false}});var u=$("<span></span>");u.append("\n").append(o);criteriumId++;var a=$("<li></li>");a.append(r).append("\n").append(i).append("\n").append(s).append("\n").append(u);$("#criteria .newCriterion").before(a)}function createCriteriumElement(e,t){var n=$('<span class="'+e+'"></span>');n.text(t);var r=$('<input type="hidden" name="criteria.'+criteriumId+"."+e+'" />');r.val(t);n.append(r);return n}function createInSearchElement(e,t){var n=$('<a class="'+e+'" href="'+t.url+'"></a>');n.text(t.description);var r=$('<input type="hidden" name="criteria.'+criteriumId+"."+e+'" />');r.val(t.id);n.append(r);n.bind("click",function(){location.href=n.attr("href");return false});return n}function updateAutocomplete(){if($("#operator").val()=="equals"&&$("#queryFieldText").val()!=""){if(autoCompleteExists){$("#searchForm input#value").autocomplete("destroy");autoCompleteExists=false}$("#searchForm input#value").autocomplete({source:baseUrl+"/advancedQuery/getFieldValues?entityfield="+$("#queryField").val()});autoCompleteExists=true}else{$("#searchForm input#value").autocomplete("destroy");autoCompleteExists=false}}$(function(){$("#queryFieldSelect").after($('<input type="text" class="text" id="queryFieldText">'));$("#queryFieldText").after($('<input type="hidden" name="criteria.0.entityfield" id="queryField"></span>'));$("#queryFieldSelect").remove();$("#queryFieldText").autocomplete({minLength:0,source:queryableFields,focus:function(e,t){$("#queryFieldText").val(t.item.show);return false},select:function(e,t){selectQueryableFieldItem(t.item);return false},change:function(e,t){if($("#queryFieldText").val().trim()==""){selectQueryableFieldItem(null)}else if(t.item==null){var n=$("#queryFieldText").autocomplete().data("ui-autocomplete").autocomplete("instance")._renderItem=function(e,t){return $("<li></li>").data("item.autocomplete",t).append("<a>"+t.show+" <span class='entity'>"+t.entity+"</span></a>").appendTo(e)};var r=$.ui.autocomplete.filter(queryableFields,$("#queryFieldText").val());if(r&&r.length>0){selectQueryableFieldItem(r[0])}else{selectQueryableFieldItem(null)}}updateAutocomplete()}})});var criteriumId=1;var autoCompleteExists=false